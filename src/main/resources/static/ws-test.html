<!-- ws-test-toggle.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test (Local & Remote)</title>
</head>
<body>
<label for="userId">ğŸ‘¤ User ID:</label>
<input id="userId" type="text" placeholder="Enter userId" value="yunuo">

<br><br>
<label for="server">ğŸ”Œ Server:</label>
<select id="server">
    <option value="ws://localhost:8080">Local (localhost:8080)</option>
    <option value="wss://plan-pal.shop">Remote (plan-pal.shop)</option>
</select>
<button onclick="connect()">Connect</button>

<br><br>
<input id="msg" type="text" placeholder="Message">
<button onclick="sendMsg()">Send</button>
<ul id="log"></ul>

<script>
    let socket;

    function connect() {
        const baseUrl = document.getElementById("server").value;
        const userId = document.getElementById("userId").value.trim() || "defaultUser";
        const url = `${baseUrl}/ws/chat?roomId=testRoom&userId=${encodeURIComponent(userId)}`;

        if (socket && socket.readyState !== WebSocket.CLOSED) {
            socket.close();
            log("ğŸ” Reconnecting...");
        }

        socket = new WebSocket(url);

        socket.onopen = () => log("âœ… Connected to " + url);
        socket.onmessage = (event) => log("ğŸ“© " + event.data);
        socket.onerror = (err) => log("âŒ Error: " + (err.message || err));
        socket.onclose = () => log("ğŸ”Œ Connection closed");
    }

    function sendMsg() {
        const msg = document.getElementById("msg").value;
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(msg);
            log("ğŸ“¤ " + msg);
        } else {
            log("âš ï¸ Not connected");
        }
    }

    function log(message) {
        const li = document.createElement("li");
        li.textContent = message;
        document.getElementById("log").appendChild(li);
    }
</script>
</body>
</html>
